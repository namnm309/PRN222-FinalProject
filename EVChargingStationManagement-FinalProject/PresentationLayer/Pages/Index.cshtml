@page
@model IndexModel
@{
    ViewData["Title"] = "Trang chủ";
}

<div class="homepage-container">
    <!-- Left Sidebar -->
    <div class="sidebar-left">
        <div class="sidebar-content">
            <!-- Header Section -->
            <div class="sidebar-header">
                <h1 class="sidebar-title">Tìm trạm sạc gần bạn</h1>
                <p class="sidebar-subtitle">Khám phá các trạm sạc xe điện xung quanh</p>
            </div>

            

            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card stat-card-green">
                    <div class="stat-value">6</div>
                    <div class="stat-label">Trạm sạc</div>
                </div>
                <div class="stat-card stat-card-blue">
                    <div class="stat-value">16</div>
                    <div class="stat-label">Còn trống</div>
                </div>
                <div class="stat-card stat-card-purple">
                    <div class="stat-value">4.7</div>
                    <div class="stat-label">Đánh giá</div>
                </div>
            </div>

            <!-- Search Section -->
            <div class="search-section">
                <div class="search-input-wrapper">
                    <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="9" cy="9" r="6" stroke="#717182" stroke-width="1.5"/>
                        <path d="M14 14L17 17" stroke="#717182" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                    <input type="text" class="search-input" placeholder="Tìm kiếm trạm sạc...">
                </div>
            </div>

            <!-- Station List -->
            <div class="station-list-header">
                <p class="station-count">6 trạm sạc được tìm thấy</p>
            </div>

            <div class="station-list">
                <!-- Station Card 1 -->
                <div class="station-card">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc VinFast Times City</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>458 Minh Khai, Hai Bà Trưng, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-available">Còn trống</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>4/8</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.8</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">1.2 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">DC Fast</span>
                        <span class="price">3,500đ/kWh</span>
                    </div>
                </div>

                <!-- Station Card 2 -->
                <div class="station-card">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc Vincom Mega Mall</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>Royal City, Thanh Xuân, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-available">Còn trống</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>2/6</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.6</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">2.5 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">DC Fast</span>
                        <span class="price">3,800đ/kWh</span>
                    </div>
                </div>

                <!-- Station Card 3 -->
                <div class="station-card">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc Aeon Mall Long Biên</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>27 Cổ Linh, Long Biên, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-full">Đầy</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>0/4</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.5</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">3.8 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">AC</span>
                        <span class="price">3,200đ/kWh</span>
                    </div>
                </div>

                <!-- Station Card 4 -->
                <div class="station-card">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc Lotte Mall</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>Lieu Giai, Ba Đình, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-available">Còn trống</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>6/10</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.9</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">4.5 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">DC Fast</span>
                        <span class="price">3,600đ/kWh</span>
                    </div>
                </div>

                <!-- Station Card 5 -->
                <div class="station-card">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc Vincom Center</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>Bà Triệu, Hoàn Kiếm, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-busy">Đang bận</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>1/4</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.7</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">0.8 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">DC Fast</span>
                        <span class="price">4,000đ/kWh</span>
                    </div>
                </div>

                <!-- Station Card 6 -->
                <div class="station-card station-card-highlight">
                    <div class="station-card-header">
                        <div class="station-info">
                            <h3 class="station-name">Trạm sạc Big C Thăng Long</h3>
                            <div class="station-address">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                                    <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                                </svg>
                                <span>Đường Thăng Long, Nam Từ Liêm, Hà Nội</span>
                            </div>
                        </div>
                        <span class="status-badge status-available">Còn trống</span>
                    </div>
                    <div class="station-details">
                        <div class="detail-left">
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M2 8H14M8 2V14" stroke="#364153" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                                <span>3/6</span>
                            </div>
                            <div class="detail-item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 2L10 6L14 7L11 10L11.5 14L8 12L4.5 14L5 10L2 7L6 6L8 2Z" stroke="#364153" stroke-width="1.5" stroke-linejoin="round"/>
                                </svg>
                                <span>4.4</span>
                            </div>
                        </div>
                        <div class="detail-right">
                            <span class="distance">5.2 km</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M8 2V14M8 2L5 5M8 2L11 5M8 14L5 11M8 14L11 11" stroke="#6A7282" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="station-footer">
                        <span class="charge-type">AC</span>
                        <span class="price">3,400đ/kWh</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Map Section -->
    <div class="map-section">
        <div id="map" class="map-container">
            <!-- Location Button on Map -->
            <button id="btn-current-location" class="btn-current-location-map" title="Vị trí của tôi">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2C6.48 2 3.5 4.98 3.5 8.5C3.5 13.25 10 18 10 18C10 18 16.5 13.25 16.5 8.5C16.5 4.98 13.52 2 10 2Z" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="10" cy="8.5" r="3" stroke="currentColor" stroke-width="1.5"/>
                </svg>
            </button>
            <!-- Map Placeholder -->
            <div class="map-placeholder">
                <div class="map-placeholder-icon">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M32 8C20.9543 8 12 16.9543 12 28C12 42 32 56 32 56C32 56 52 42 52 28C52 16.9543 43.0457 8 32 8Z" stroke="#6A7282" stroke-width="2"/>
                        <circle cx="32" cy="28" r="8" stroke="#6A7282" stroke-width="2"/>
                    </svg>
                </div>
                <h3 class="map-placeholder-title">Bản đồ trạm sạc</h3>
                <p class="map-placeholder-text">Chọn một trạm sạc từ danh sách bên trái để xem chi tiết và chỉ đường</p>
            </div>
        </div>
        
        <!-- Map Info Card (Hidden by default, shown when station selected) -->
        <div class="map-info-card" style="display: none;">
            <div class="map-info-header">
                <div class="map-info-title-section">
                    <h3 class="map-info-title">Trạm sạc Big C Thăng Long</h3>
                    <div class="map-info-address">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 2C5.24 2 3 4.24 3 7C3 10.5 8 14 8 14C8 14 13 10.5 13 7C13 4.24 10.76 2 8 2Z" stroke="#4A5565" stroke-width="1.5"/>
                            <circle cx="8" cy="7" r="2" stroke="#4A5565" stroke-width="1.5"/>
                        </svg>
                        <span>Đường Thăng Long, Nam Từ Liêm, Hà Nội</span>
                    </div>
                </div>
                <span class="status-badge status-available">Còn trống</span>
            </div>
            <div class="map-info-details">
                <div class="map-detail-grid">
                    <div class="map-detail-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 10H18M10 2V18" stroke="#4A5565" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <div>
                            <div class="map-detail-label">Cổng sạc</div>
                            <div class="map-detail-value">3/6</div>
                        </div>
                    </div>
                    <div class="map-detail-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2V18M10 2L7 5M10 2L13 5M10 18L7 15M10 18L13 15" stroke="#4A5565" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <div>
                            <div class="map-detail-label">Khoảng cách</div>
                            <div class="map-detail-value">5.2 km</div>
                        </div>
                    </div>
                    <div class="map-detail-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2L5 7L10 12L15 7L10 2Z" stroke="#4A5565" stroke-width="1.5" stroke-linejoin="round"/>
                        </svg>
                        <div>
                            <div class="map-detail-label">Loại sạc</div>
                            <div class="map-detail-value">AC</div>
                        </div>
                    </div>
                    <div class="map-detail-item">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M10 2L12 8L18 9L13 13L14 19L10 15L6 19L7 13L2 9L8 8L10 2Z" stroke="#4A5565" stroke-width="1.5" stroke-linejoin="round"/>
                        </svg>
                        <div>
                            <div class="map-detail-label">Đánh giá</div>
                            <div class="map-detail-value">4.4/5</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="map-info-footer">
                <div class="map-price-section">
                    <div class="map-price-label">Giá sạc</div>
                    <div class="map-price-value">3,400đ/kWh</div>
                </div>
                <button class="btn-direction">
                    <span>Chỉ đường</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 12L10 8L6 4" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Legend -->
        <div class="map-legend">
            <div class="legend-title">Chú thích</div>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color legend-green"></div>
                    <span>Còn trống</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-yellow"></div>
                    <span>Đang bận</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-red"></div>
                    <span>Đầy</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color legend-blue"></div>
                    <span>Vị trí của bạn</span>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var currentUserMarker = null;
        var mapInstance = null;
        
        setTimeout(function() {
            if (typeof L !== 'undefined') {
                var placeholder = document.querySelector('.map-placeholder');
                if (placeholder) placeholder.style.display = 'none';
                
                var mapEl = document.getElementById('map');
                if (mapEl) {
                    mapInstance = L.map('map').setView([21.0285, 105.8542], 12);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19
                    }).addTo(mapInstance);
                    
                    setTimeout(function() {
                        if (mapInstance.invalidateSize) mapInstance.invalidateSize();
                    }, 300);
                    
                    var stations = [
                        { lat: 21.0285, lng: 105.8542, status: "available" },
                        { lat: 21.0055, lng: 105.8435, status: "available" },
                        { lat: 21.0175, lng: 105.9185, status: "full" },
                        { lat: 21.0375, lng: 105.8145, status: "available" },
                        { lat: 21.0245, lng: 105.8525, status: "busy" },
                        { lat: 21.0505, lng: 105.7545, status: "available" }
                    ];
                    
                    for (var i = 0; i < stations.length; i++) {
                        var s = stations[i];
                        var c = s.status === 'available' ? '#00A63E' : s.status === 'busy' ? '#F0B100' : '#E7000B';
                        var icon = L.divIcon({
                            className: 'custom-marker',
                            html: '<div style="background:' + c + ';width:16px;height:16px;border-radius:50%;border:2px solid white;"></div>',
                            iconSize: [16, 16],
                            iconAnchor: [8, 8]
                        });
                        L.marker([s.lat, s.lng], {icon: icon}).addTo(mapInstance);
                    }
                    
                    // Function to update user location
                    function updateUserLocation(lat, lng, showPopup) {
                        showPopup = showPopup || false;
                        
                        // Remove old marker if exists
                        if (currentUserMarker) {
                            mapInstance.removeLayer(currentUserMarker);
                        }
                        
                        // Add new marker at current location
                        var userIcon = L.divIcon({
                            className: 'custom-marker',
                            html: '<div style="background:#155DFC;width:20px;height:20px;border-radius:50%;border:2px solid white;"></div>',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        });
                        currentUserMarker = L.marker([lat, lng], {icon: userIcon}).addTo(mapInstance);
                        currentUserMarker.bindPopup('<b>Vị trí của bạn</b>');
                        
                        if (showPopup) {
                            currentUserMarker.openPopup();
                        }
                        
                        // Center map on user location
                        mapInstance.setView([lat, lng], 15);
                    }
                    
                    // Try to get real location on page load
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            function(position) {
                                var lat = position.coords.latitude;
                                var lng = position.coords.longitude;
                                updateUserLocation(lat, lng, false);
                            },
                            function(error) {
                                // If location access denied, use default (Hanoi)
                                updateUserLocation(21.0285, 105.8542, false);
                            }
                        );
                    } else {
                        // Browser doesn't support geolocation, use default
                        updateUserLocation(21.0285, 105.8542, false);
                    }
                    
                    // Add click handler for location button
                    var btnLocation = document.getElementById('btn-current-location');
                    if (btnLocation) {
                        btnLocation.addEventListener('click', function() {
                            if (navigator.geolocation) {
                                btnLocation.style.opacity = '0.6';
                                btnLocation.disabled = true;
                                
                                navigator.geolocation.getCurrentPosition(
                                    function(position) {
                                        var lat = position.coords.latitude;
                                        var lng = position.coords.longitude;
                                        updateUserLocation(lat, lng, true);
                                        
                                        btnLocation.style.opacity = '1';
                                        btnLocation.disabled = false;
                                    },
                                    function(error) {
                                        var errorMsg = 'Không thể lấy vị trí của bạn. ';
                                        if (error.code === 1) {
                                            errorMsg += 'Vui lòng cho phép truy cập vị trí trong cài đặt trình duyệt.';
                                        } else if (error.code === 2) {
                                            errorMsg += 'Vị trí không khả dụng.';
                                        } else {
                                            errorMsg += 'Đã xảy ra lỗi khi lấy vị trí.';
                                        }
                                        alert(errorMsg);
                                        btnLocation.style.opacity = '1';
                                        btnLocation.disabled = false;
                                    },
                                    {
                                        enableHighAccuracy: true,
                                        timeout: 10000,
                                        maximumAge: 0
                                    }
                                );
                            } else {
                                alert('Trình duyệt của bạn không hỗ trợ định vị.');
                            }
                        });
                    }
                }
            }
        }, 1000);
    </script>
    <style>
        .custom-marker { background: transparent !important; border: none !important; }
        .leaflet-container { background: #F3F4F6 !important; }
        
        .btn-current-location-map {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.2s;
            color: #155DFC;
        }
        
        .btn-current-location-map:hover {
            background: #f8f9fa;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .btn-current-location-map:active {
            transform: scale(0.95);
        }
        
        .btn-current-location-map:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
}
