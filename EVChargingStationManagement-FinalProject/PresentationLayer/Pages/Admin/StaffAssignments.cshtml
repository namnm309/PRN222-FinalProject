@page
@model PresentationLayer.Pages.Admin.StaffAssignmentsModel
@{
    Layout = "~/Pages/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Admin ‚Ä¢ Ph√¢n quy·ªÅn nh√¢n vi√™n";
}

<section class="page-header d-flex justify-content-between align-items-center">
    <h2>@ViewData["Title"]</h2>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#assignModal">
        <span>‚ûï</span> G√°n nh√¢n vi√™n
    </button>
</section>

<form method="get" class="filters mb-3">
    <div class="row g-2">
        <div class="col-md-4">
            <input type="text" name="q" value="@Model.Query" class="form-control" placeholder="üîç T√¨m theo t√™n tr·∫°m, nh√¢n vi√™n..." />
        </div>
        <div class="col-md-4">
            <select class="form-select" name="role">
                <option value="">T·∫•t c·∫£ vai tr√≤</option>
                @foreach (var item in Model.RoleOptions)
                {
                    <option value="@item.Value" selected="@(Model.RoleFilter == item.Value)">@item.Text</option>
                }
            </select>
        </div>
        <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-primary">L·ªçc</button>
        </div>
        <div class="col-md-2 d-grid">
            <a href="/Admin/StaffAssignments" class="btn btn-outline-secondary">X√≥a b·ªô l·ªçc</a>
        </div>
    </div>
</form>

<section class="kpis mb-3">
    <div class="row g-3">
        <div class="col-sm-6 col-lg-3">
            <div class="card p-3">
                <div class="small text-muted">T·ªïng ph√¢n c√¥ng</div>
                <div class="h4 mb-0">@Model.Assignments.Count</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card p-3">
                <div class="small text-muted">Qu·∫£n l√Ω (Manager)</div>
                <div class="h4 mb-0">@Model.Assignments.Count(a => a.Role == "Manager")</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card p-3">
                <div class="small text-muted">V·∫≠n h√†nh (Operator)</div>
                <div class="h4 mb-0">@Model.Assignments.Count(a => a.Role == "Operator")</div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card p-3">
                <div class="small text-muted">K·ªπ thu·∫≠t (Technician)</div>
                <div class="h4 mb-0">@Model.Assignments.Count(a => a.Role == "Technician")</div>
            </div>
        </div>
    </div>
</section>

<section class="content-grid">
    <div class="table-responsive card">
        <table class="table table-hover mb-0 align-middle">
            <thead class="table-light">
                <tr>
                    <th>Tr·∫°m s·∫°c</th>
                    <th>Nh√¢n vi√™n</th>
                    <th>Vai tr√≤</th>
                    <th>Ng√†y g√°n</th>
                    <th class="text-end">Thao t√°c</th>
                </tr>
            </thead>
            <tbody>
            @if (!Model.Assignments.Any())
            {
                <tr><td colspan="5" class="text-center text-muted py-4">Ch∆∞a c√≥ nh√¢n vi√™n n√†o ƒë∆∞·ª£c g√°n.</td></tr>
            }
            else
            {
                foreach (var ass in Model.Assignments)
                {
                    <tr>
                        <td><strong>@ass.StationName</strong></td>
                        <td>@ass.StaffName</td>
                        <td>
                            <span class="badge @(ass.Role == "Manager" ? "bg-dark" : ass.Role == "Technician" ? "bg-warning" : "bg-info")">@ass.Role</span>
                        </td>
                        <td>@ass.CreatedAt.ToString("dd/MM/yyyy")</td>
                        <td class="text-end">
                            <form method="post" asp-page-handler="Remove" asp-route-id="@ass.Id" class="d-inline" onsubmit="return confirm('G·ª° nh√¢n vi√™n kh·ªèi tr·∫°m n√†y?')">
                                <button type="submit" class="btn btn-sm btn-outline-danger" title="G·ª° nh√¢n vi√™n">üóëÔ∏è G·ª°</button>
                            </form>
                        </td>
                    </tr>
                }
            }
            </tbody>
        </table>
    </div>
</section>

<!-- Assign Modal -->
<div class="modal fade" id="assignModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="post" asp-page-handler="Assign">
        <div class="modal-header">
          <h5 class="modal-title">G√°n nh√¢n vi√™n v√†o tr·∫°m</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Tr·∫°m s·∫°c</label>
            <select name="ChargingStationId" class="form-select" required>
              @foreach (var station in Model.AllStations)
              {
                  <option value="@station.Id">@station.Name</option>
              }
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Nh√¢n vi√™n</label>
            <select name="UserId" class="form-select" required>
              @foreach (var staff in Model.AllStaff)
              {
                  <option value="@staff.Id">@staff.Name (@staff.Email)</option>
              }
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Vai tr√≤</label>
            <select name="Role" class="form-select" required>
              @foreach (var role in Model.RoleOptions)
              {
                  <option value="@role.Value">@role.Text</option>
              }
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
          <button type="submit" class="btn btn-success">G√°n</button>
        </div>
      </form>
    </div>
  </div>
</div>

