@page
@{
    Layout = "~/Pages/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Admin • Sửa trạm sạc";
}

<div class="add-station-container" style="display: flex; height: calc(100vh - 120px); gap: 0;">
    <!-- Left Form Section -->
    <div class="form-section" style="width: 450px; background: white; border-right: 1px solid #e5e7eb; overflow-y: auto; padding: 24px;">
        <div class="form-header" style="margin-bottom: 24px;">
            <h2 style="font-size: 24px; font-weight: 600; margin: 0 0 8px 0;">Sửa trạm sạc</h2>
            <p style="color: #6b7280; font-size: 14px; margin: 0;">Cập nhật thông tin trạm sạc</p>
        </div>

        <!-- Search Section -->
        <div class="search-section" style="margin-bottom: 24px;">
            <div class="search-input-wrapper" style="position: relative;">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #717182;">
                    <circle cx="9" cy="9" r="6" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M14 14L17 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
                <input type="text" class="search-input" id="stationSearchInput" placeholder="Tìm kiếm trạm sạc..." style="width: 100%; padding: 10px 12px 10px 40px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
            </div>
        </div>

        <!-- Form -->
        <form id="stationForm">
            <input type="hidden" id="stationId" name="id">

            <div class="mb-3">
                <label for="stationName" class="form-label">Tên trạm <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="stationName" name="name" required>
            </div>

            <div class="mb-3">
                <label for="stationAddress" class="form-label">Địa chỉ <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="stationAddress" name="address" required>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="stationCity" class="form-label">Thành phố</label>
                    <input type="text" class="form-control" id="stationCity" name="city">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="stationProvince" class="form-label">Tỉnh/Thành</label>
                    <input type="text" class="form-control" id="stationProvince" name="province">
                </div>
            </div>

            <div class="mb-3">
                <label for="stationPostalCode" class="form-label">Mã bưu điện</label>
                <input type="text" class="form-control" id="stationPostalCode" name="postalCode">
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="stationLatitude" class="form-label">Vĩ độ <span class="text-danger">*</span></label>
                    <input type="number" step="any" min="-90" max="90" class="form-control" id="stationLatitude" name="latitude" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="stationLongitude" class="form-label">Kinh độ <span class="text-danger">*</span></label>
                    <input type="number" step="any" min="-180" max="180" class="form-control" id="stationLongitude" name="longitude" required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="stationPhone" class="form-label">Số điện thoại</label>
                    <input type="tel" class="form-control" id="stationPhone" name="phone">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="stationEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="stationEmail" name="email">
                </div>
            </div>

            <div class="mb-3">
                <label for="stationStatus" class="form-label">Trạng thái <span class="text-danger">*</span></label>
                <select class="form-select" id="stationStatus" name="status" required>
                    <option value="0">Active</option>
                    <option value="1">Inactive</option>
                    <option value="2">Maintenance</option>
                </select>
            </div>

            <!-- Charging Spots Configuration -->
            <div class="mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <label class="form-label fw-bold mb-0">Cấu hình cổng sạc</label>
                    <button type="button" class="btn btn-sm btn-primary" id="btn-add-spot">
                        <i class="bi bi-plus-circle"></i> Thêm cổng sạc
                    </button>
                </div>
            </div>

            <div id="spots-container" class="spots-container mb-3">
                <!-- Spots will be loaded and added here dynamically -->
            </div>

            <div id="spots-empty" class="text-center text-muted py-3" style="display: none;">
                <small>Chưa có cổng sạc nào. Nhấn "Thêm cổng sạc" để thêm.</small>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="stationOpeningTime" class="form-label">Giờ mở cửa</label>
                    <input type="time" class="form-control" id="stationOpeningTime" name="openingTime">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="stationClosingTime" class="form-label">Giờ đóng cửa</label>
                    <input type="time" class="form-control" id="stationClosingTime" name="closingTime">
                </div>
            </div>

            <div class="mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="stationIs24Hours" name="is24Hours">
                    <label class="form-check-label" for="stationIs24Hours">
                        24/7
                    </label>
                </div>
            </div>

            <div class="mb-3">
                <label for="stationDescription" class="form-label">Mô tả</label>
                <textarea class="form-control" id="stationDescription" name="description" rows="3"></textarea>
            </div>

            <!-- SerpAPI Info (Readonly) -->
            <div class="mb-3">
                <label class="form-label">Thông tin SerpAPI</label>
                <div class="card" style="background: #f9fafb; border: 1px solid #e5e7eb;">
                    <div class="card-body" style="padding: 12px;">
                        <div class="mb-2">
                            <small class="text-muted">Place ID:</small>
                            <div id="serpApiPlaceId" style="font-size: 13px; word-break: break-all;">--</div>
                        </div>
                        <div class="mb-2">
                            <small class="text-muted">Rating:</small>
                            <div id="serpApiRating" style="font-size: 13px;">--</div>
                        </div>
                        <div>
                            <small class="text-muted">Reviews:</small>
                            <div id="serpApiReviews" style="font-size: 13px;">--</div>
                        </div>
                    </div>
                </div>
            </div>

            <input type="hidden" id="serpApiPlaceIdInput" name="serpApiPlaceId">
            <input type="hidden" id="externalRatingInput" name="externalRating">
            <input type="hidden" id="externalReviewCountInput" name="externalReviewCount">

            <div class="d-flex gap-2">
                <button type="button" class="btn btn-secondary" onclick="window.location.href='/Admin/Stations'" style="flex: 1;">Hủy</button>
                <button type="submit" class="btn btn-primary" id="saveStationBtn" style="flex: 1;">Cập nhật trạm sạc</button>
            </div>
        </form>
    </div>

    <!-- Right Map Section -->
    <div class="map-section" style="flex: 1; position: relative;">
        <div id="map" class="map-container" style="width: 100%; height: 100%;"></div>
        
        <!-- Map Controls -->
        <div class="map-overlay-bar" style="position: absolute; bottom: 24px; left: 24px; display: flex; gap: 12px; z-index: 1000;">
            <button id="btn-current-location" class="btn-current-location-map" title="Vị trí của tôi" style="background: white; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.15); color: #155DFC;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 2C6.48 2 3.5 4.98 3.5 8.5C3.5 13.25 10 18 10 18C10 18 16.5 13.25 16.5 8.5C16.5 4.98 13.52 2 10 2Z" stroke="currentColor" stroke-width="1.5"/>
                    <circle cx="10" cy="8.5" r="3" stroke="currentColor" stroke-width="1.5"/>
                </svg>
            </button>
            <button id="btn-search-nearby" class="btn-current-location-map" title="Tìm trạm sạc gần đây" style="background: white; border: 1px solid rgba(0, 0, 0, 0.1); border-radius: 8px; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.15); color: #155DFC;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 2.5C5.46243 2.5 3 4.96243 3 8C3 11.0376 5.46243 13.5 8.5 13.5C9.93373 13.5 11.2392 12.9728 12.2513 12.0864L16.0821 15.9171C16.4727 16.3077 17.1058 16.3077 17.4964 15.9171C17.887 15.5266 17.887 14.8934 17.4964 14.5029L13.6657 10.6721C14.552 9.66096 15.0792 8.35549 15.0792 6.92176C15.0792 3.88419 12.6168 1.42176 9.57924 1.42176C8.14551 1.42176 6.84004 1.94894 5.82891 2.83529C4.81778 3.72165 4.2906 5.02712 4.2906 6.46085" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="~/js/admin-edit-station.js" asp-append-version="true"></script>
}

