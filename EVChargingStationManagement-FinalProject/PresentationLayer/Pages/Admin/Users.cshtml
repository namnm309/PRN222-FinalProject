@page 
@{
    Layout = "~/Pages/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Admin • Người dùng";
}

<section class="page-header">
    <h2>@ViewData["Title"]</h2>
</section>

<section class="filters">
    <div class="filter-group">
        <label for="UserRoleFilter">Vai trò</label>
        <select id="UserRoleFilter" class="form-select">
            <option value="">Tất cả</option>
            <option value="0">Driver (EVDriver)</option>
            <option value="1">Staff (CSStaff)</option>
            <option value="2">Admin</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="UserStatusFilter">Trạng thái</label>
        <select id="UserStatusFilter" class="form-select">
            <option value="">Tất cả</option>
            <option value="true">Đang hoạt động</option>
            <option value="false">Đã vô hiệu hóa</option>
        </select>
    </div>
    <div class="filter-group">
        <label for="UserSearch">Tìm kiếm</label>
        <input type="text" id="UserSearch" class="form-control" placeholder="Tên, email, username...">
    </div>
    <div class="filter-group">
        <button class="btn btn-outline-primary" data-action="refresh-users">
            <i class="bi bi-arrow-clockwise"></i> Làm mới
        </button>
    </div>
</section>

<section class="content-grid">
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Tên</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Vai trò</th>
                    <th>Trạng thái</th>
                    <th>Ngày tạo</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="usersTableBody">
                <tr>
                    <td colspan="8" class="text-center">Đang tải dữ liệu...</td>
                </tr>
            </tbody>
        </table>
    </div>
</section>

<div class="d-flex justify-content-between align-items-center mt-3">
    <div>
        <span id="paginationInfo" class="text-muted">Hiển thị 0 - 0 của 0</span>
    </div>
    <nav>
        <ul class="pagination pagination-sm mb-0" id="pagination">
        </ul>
    </nav>
</div>

<!-- Modal Chi tiết User -->
<div class="modal fade" id="userDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Chi tiết người dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <p class="text-center">Đang tải...</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Thay đổi Role -->
<div class="modal fade" id="changeRoleModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thay đổi vai trò</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="changeRoleForm">
                    <input type="hidden" id="changeRoleUserId">
                    <div class="mb-3">
                        <label for="newRole" class="form-label">Vai trò mới <span class="text-danger">*</span></label>
                        <select class="form-select" id="newRole" name="role" required>
                            <option value="0">Driver (EVDriver)</option>
                            <option value="1">Staff (CSStaff)</option>
                        </select>
                        <small class="form-text text-muted">Lưu ý: Không thể thay đổi role của Admin</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveRoleBtn">Lưu</button>
            </div>
        </div>
    </div>
</div>

<style>
    .btn-view-detail:hover {
        background-color: #0d6efd;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.3);
    }
    
    .btn-change-role:hover {
        background-color: #ffc107;
        color: black;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
    }
    
    .btn-toggle-status:hover {
        background-color: #198754;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(25, 135, 84, 0.3);
    }
    
    .btn-view-detail:active,
    .btn-change-role:active,
    .btn-toggle-status:active {
        transform: translateY(0);
    }
    
    .badge-role {
        padding: 0.35em 0.65em;
        font-size: 0.875em;
        font-weight: 600;
    }
    
    .badge-role.driver {
        background-color: #0dcaf0;
        color: #000;
    }
    
    .badge-role.staff {
        background-color: #ffc107;
        color: #000;
    }
    
    .badge-role.admin {
        background-color: #dc3545;
        color: #fff;
    }
</style>

@section Scripts {
    <script src="~/js/admin-users.js" asp-append-version="true"></script>
}
