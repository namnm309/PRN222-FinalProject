@page "/Auth/EditProfile"
@model PresentationLayer.Pages.Auth.EditProfileModel
@{
    ViewData["Title"] = "Chỉnh sửa hồ sơ";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Chỉnh sửa hồ sơ</h4>
                </div>
                <div class="card-body">
                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="alert alert-danger" role="alert">
                            @Model.ErrorMessage
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
                    {
                        <div class="alert alert-success" role="alert">
                            @Model.SuccessMessage
                        </div>
                    }

                    @if (Model.CurrentUser != null)
                    {
                        <form method="post">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="EditRequest.FullName" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                                    <input asp-for="EditRequest.FullName" class="form-control" required />
                                    <span asp-validation-for="EditRequest.FullName" class="text-danger"></span>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label asp-for="EditRequest.Email" class="form-label">Email <span class="text-danger">*</span></label>
                                    <input asp-for="EditRequest.Email" type="email" class="form-control" required />
                                    <span asp-validation-for="EditRequest.Email" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label asp-for="EditRequest.Phone" class="form-label">Số điện thoại <span class="text-danger">*</span></label>
                                    <input asp-for="EditRequest.Phone" class="form-control" required />
                                    <span asp-validation-for="EditRequest.Phone" class="text-danger"></span>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label asp-for="EditRequest.DateOfBirth" class="form-label">Ngày sinh <span class="text-danger">*</span></label>
                                    <input asp-for="EditRequest.DateOfBirth" type="date" class="form-control" required />
                                    <span asp-validation-for="EditRequest.DateOfBirth" class="text-danger"></span>
                                    @if (Model.CurrentUser.DateOfBirth == DateTime.MinValue)
                                    {
                                        <small class="text-muted">Bạn cần cập nhật ngày sinh của mình</small>
                                    }
                                </div>
                            </div>

                            <div class="mb-3">
                                <label asp-for="EditRequest.Gender" class="form-label">Giới tính <span class="text-danger">*</span></label>
                                <select asp-for="EditRequest.Gender" class="form-select" required>
                                    <option value="">-- Chọn giới tính --</option>
                                    <option value="Male">Nam</option>
                                    <option value="Female">Nữ</option>
                                    <option value="Other">Khác</option>
                                    <option value="Unknown">Không tiết lộ</option>
                                </select>
                                <span asp-validation-for="EditRequest.Gender" class="text-danger"></span>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Tên đăng nhập</label>
                                <input type="text" class="form-control" value="@Model.CurrentUser.Username" disabled />
                                <small class="text-muted">Tên đăng nhập không thể thay đổi</small>
                            </div>

                            @if (!string.IsNullOrEmpty(Model.CurrentUser.GoogleId))
                            {
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> Tài khoản này được liên kết với Google
                                </div>
                            }

                            <div class="d-flex justify-content-between mt-4">
                                <a asp-page="/Index" class="btn btn-secondary">Hủy</a>
                                <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                            </div>
                        </form>
                    }
                    else
                    {
                        <div class="alert alert-warning">
                            Không tìm thấy thông tin người dùng. Vui lòng đăng nhập lại.
                        </div>
                        <a asp-page="/Auth/Login" class="btn btn-primary">Đăng nhập</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

